

<style>
  .df{
    display:flex;
    align-items: center;
  }
  .tab_cg{
      border:1px solid #eaeaea;
      margin-right: 20px;
      margin-left: 0;
  }
  .tab_text,.tab_btn{
    padding: 5px 10px;
  }
  .tab_btn{
    border-left:1px solid #eaeaea;
  }
  button{
    outline: none;
  }
  .tabBox{
    margin-top:20px;
  }
  label{
    margin:0;
  }
  .tab_box{
    height:200px;
    overflow:hidden;
    overflow-y:auto;
    margin-top:0;
  }
  .tab{
    display:inline-block;
    padding:5px;
    border:1px solid #eaeaea;
    margin-right:10px;
    cursor: pointer;
    margin-bottom: 10px;
  }
  
  .tabBox label{
    white-space: nowrap;
  }
  #tabBox_xz{
    flex-wrap:wrap;
    max-height:200px;
    overflow:hidden;
    overflow-y:auto;
  }
    #tabBox_xz .tab_cg{
    margin-bottom:10px;
  }
  .tab:hover{
    background:#2aabd2;
    color:#fff;
  }
  #myModal{
    background: rgba(0,0,0,0)
  }
  .we7-modal-dialog, .modal-dialog1{
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    margin-top: 100px;
    margin-left: auto;
    margin-right: auto;
  }
  .modal-dialog1{width: 750px!important;}
  .modal-footer{display: flex;justify-content: center;}
  /*账户充值样式*/
   .recharge_info{display: -webkit-box;display: -webkit-flex;display: -ms-flexbox;display: flex;justify-content: space-around;margin-bottom: 10px;}
.recharge_info>div{-webkit-box-flex: 1;-webkit-flex: 1;-ms-flex: 1;flex: 1;border:1px solid #efefef;padding:10px 22px;line-height: 25px;color: #333;}
.recharge_info>div:first-child{margin-right: 10px;}
.recharge_info>div:last-child{margin-left: 10px;}
.zhe{background: rgba(0,0,0,0.6);position: fixed;display: flex;align-items: center;justify-content: center;width: 100%;height: 100%;top: 0;left: 0;}
.modal-dialog1{position: initial;}

.modal.in .modal-dialog1 {
    transform: translate(0,0);
    top: 70px;
    left: 0;
    position: absolute;
    right: 0;
    bottom: 0;
    margin: auto auto;
}
.modal-dialog1 .modal-content {
    border-radius: 0;
    max-height: inherit;
    padding: 0 20px;
}
.alert{
	position: fixed;
	top: 30px;
	left: 0;
	z-index: 9999;
	right: 0;
	width: 200px;
	margin: 0 auto;
	text-align: center;
	height: 32px;
	line-height: 32px;
	padding: 0;
}
  /*账户充值end*/
}
</style>
<form>
	<div class="modal" id="myModal" style="display: flex;">
	  <div class="modal-dialog1" role="document">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close close1" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
	        <h4 class="modal-title" id="myModalLabel">添加标签</h4>
	      </div>

         <!--  <div class="form-group">
              <label class="col-sm-2 control-label">选择分类</label>
              <div class="col-sm-9">
                  {php  echo tpl_form_field_category_2level('category_name', $parentpfxm, $childrenpfxm,$item['parentid'],$item['childrenid']);}
              </div>
          </div> -->

          <div class="form-group" style="margin-top: 30px;">
              <label class="col-sm-2 control-label">科室类别<span class="must-fill">*</span>
              </label>
              <div class="col-sm-9">

                  <div class="row row-fix tpl-category-container">
                      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                          <select class="form-control tpl-category-parent we7-select" id="category_parent" name="z_room">
                              <option value="0">请选择一级分类</option>
                              {loop $ks_list $item}
                                    <option value="{$item['id']}" {if $item['id']==$res['z_room']} selected="selected" {/if}>{$item['ctname']}</option>
                              {/loop}
                          </select>
                      </div>
                      <div class="col-xs-12 col-sm-6 col-md-6 col-lg-6">
                          <select class="form-control tpl-category-child we7-select" id="category_child" name="parentid">
                               <option value='0'>请选择二级分类</option>
                               {loop $ks_two $kst}
                               <option value="{$kst['id']}" {if $kst['id']==$res['parentid']} selected="selected" {/if}>{$kst['name']}</option>
                               {/loop}
                          </select>
                      </div>
                  </div>
              </div>
          </div>
	      <div class="modal-body form-group">
            <label class="col-sm-2 control-label">词库</label>
	          <div class="tab_box">
	                  <!-- <div class="tab">发烧1</div> -->
	              </div>
	        
	            <div class="tabBox form-group"> 
                <label class="col-sm-2 control-label">已选择</label>
	              <div class="df" id="tabBox_xz">
                    {if !empty($u_label)}
                      {loop $u_label $lab}
	                  <div class="df tab_cg">
	                    <div class="tab_text">{$lab}</div>
	                    <div class="tab_btn"><button type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button> </div>
	                 </div>
                   {/loop}
                    {/if}
	            </div>
	          </div>
	     <div class="form-group">
       <label  class="col-sm-2 control-label" for="exampleInputEmail2">自定义标签</label>
	          <div class="df">
	            <input type="text" class="form-control" id="tabInput" placeholder="">
              <button type="button" class="btn btn-primary addTab">添加</button>
	          </div>

	        </div>
	        

	      </div>
	      
	      
	      <div class="modal-footer">
          <input type="hidden" name="u_id" value="{$u_id}" id='u_id'/>
	        <button type="button" class="btn btn-primary addBtn" data-dismiss="modal" style="padding: 7px 30px;">确认添加</button>
          <button type="button" class="btn btn-default close1" data-dismiss="modal" style="padding: 7px 30px;">取消</button>
	      </div>
	    </div>
	  </div>
	</div>
</form>

<script type="text/javascript">
    $("#category_parent").on("change",function(){
        var id = $(this).val()
        //查询二级
        $.post("./index.php?c=site&a=entry&op=userlabel_keshi&do=copysite&m=hyb_yl&act=profile.userlabel_keshi&ac=notice&id="+id,{id:id},function (res) {
              console.log(res);
                $("select[name='parentid']").empty();
                var html = "<option value='0'>请选择二级分类</option>";
                $(res).each(function (v, k) {

                    html += "<option value='" + k.id + "'>" + k.name + "</option>";
                });
                //把遍历的数据放到select表里面
                $("select[name='parentid']").append(html);

            },'json');
    });

    $("#category_child").on("change",function(){
    
        var id = $(this).val()
        //查询二级
        $.post("./index.php?c=site&a=entry&op=userlabel_keshiinfo&do=copysite&m=hyb_yl&act=profile.userlabel_keshiinfo&ac=notice&id="+id,{id:id},function (res) {
            console.log(res)
                var html="";
                $('.tab_box').html("")
                for(var i=0;i<res.length;i++){
                    $('.tab_box').append(`<div class="tab">${res[i]}</div>`)                  
                }
        },'json');
    });
</script>


<script type="text/javascript">
    $("#reset").on('click',function(){
        $("#color").val('#666').trigger('propertychange');
    });
  $(document).unbind('click').on('click','.tab',function(e){

    var tabText=$(this).text().trim()
    var textlen=$('.tabBox').find('.tab_cg').length
    for(var i=0;i<textlen;i++){
      console.log($('.tabBox').find('.tab_cg .tab_text').eq(i).text().trim())
      console.log(tabText)
        if(tabText==$('.tabBox').find('.tab_cg .tab_text').eq(i).text().trim()){
            alert('已添加相同的标签')
            return
           }
    }
    $('#tabBox_xz').append(`
         <div class="df tab_cg">
                    <div class="tab_text">${tabText}</div>
                    <div class="tab_btn"><button type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button> </div>
                </div>
    `)
  })
  
  $(document).on('click','.close',function(){
    console.log($(this).parents('.tab_cg'))
    $(this).parents('.tab_cg').remove()
  })
  
  $('.addTab').on('click',function(){
    var text=$('#tabInput').val().trim()
    if(text==''){
      $('#tabInput').focus()
        alert('请填写自定义标签')
    }else{
        $('.tab_box').append(`
        <div class="tab">${text}</div>
    `)
      $('#tabInput').val('')
       }
  })
  
  $('.addBtn').on('click',function(){
    var arr=[]
        $('#tabBox_xz').find('.tab_text').each(function(index,val){
          arr.push($(val).text())
        })
        
        var u_id = $('#u_id').val();
          console.log(arr)
          console.log(u_id)
          //查询二级
        $.post("./index.php?c=site&a=entry&op=adduserlabel&do=copysite&m=hyb_yl&act=profile.adduserlabel&ac=notice",{arr:arr,u_id:u_id},function (res2) {
            console.log(res2)

            if(res2=='1'){ 
              util.tips("操作成功！");
              setTimeout(function(){ 
                window.location.reload();
              }, 1000);
            }else{
              util.tips("操作失败");  
            };
        },'json');

  })
    $(document).on('click','.biaoqian',function(){
    $('#myModal').show()
})
      $('.close1').on('click',function(){
    $('#myModal').hide()
    window.location.reload()

  })
$('.close').on('click',function(){
    $('.zhe').hide()

})
$('.quxiao').on('click',function(){
    $('.zhe').hide()

})
// 账户按钮结束
</script>
