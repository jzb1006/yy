{php include wl_template('common/header');}
<link rel="stylesheet" href="{URL_MODULE}web/resource/diy/css/diy.min.css">
<ul class="nav nav-tabs">
    <li class="active"><a href="javascript:;">页面列表</a></li>
</ul>
<div class="app-content">
    <!--顶部信息-->
    <div class="app-filter">
        <div class="filter-action">
            <a id="create_page" href="javascript:;" class="btn btn-primary">新建页面</a>
        </div>
        <div class="filter-list">
            <form class="form-horizontal" action="" method="post">
                <div class="form-group">
                    <div class="col-sm-2 control-label">页面类型</div>
                    <div class="col-sm-9">
                        {if $pageClass == 1}
                            <a href="{php echo web_url('diypage/diy/pagelist')}" class="btn btn-{if !$_GPC['page_type']}primary{else}default{/if}">全部</a>
                            <a href="{php echo web_url('diypage/diy/pagelist',array('page_type'=>1))}" class="btn btn-{if $_GPC['page_type'] == 1}primary{else}default{/if}">自定义页面</a>
                            <a href="{php echo web_url('diypage/diy/pagelist',array('page_type'=>2))}" class="btn btn-{if $_GPC['page_type'] == 2}primary{else}default{/if}">平台首页</a>
                            <a href="{php echo web_url('diypage/diy/pagelist',array('page_type'=>3))}" class="btn btn-{if $_GPC['page_type'] == 3}primary{else}default{/if}">抢购首页</a>
                            <a href="{php echo web_url('diypage/diy/pagelist',array('page_type'=>4))}" class="btn btn-{if $_GPC['page_type'] == 4}primary{else}default{/if}">团购首页</a>
                            <a href="{php echo web_url('diypage/diy/pagelist',array('page_type'=>5))}" class="btn btn-{if $_GPC['page_type'] == 5}primary{else}default{/if}">卡券首页</a>
                            <a href="{php echo web_url('diypage/diy/pagelist',array('page_type'=>6))}" class="btn btn-{if $_GPC['page_type'] == 6}primary{else}default{/if}">拼团首页</a>
                            <a href="{php echo web_url('diypage/diy/pagelist',array('page_type'=>7))}" class="btn btn-{if $_GPC['page_type'] == 7}primary{else}default{/if}">砍价首页</a>
                        {else}
                            <a href="{php echo web_url('chosen/diy/pagelist')}" class="btn btn-{if !$_GPC['page_type']}primary{else}default{/if}">全部</a>
                            <a href="{php echo web_url('chosen/diy/pagelist',array('page_type'=>1))}" class="btn btn-{if $_GPC['page_type'] == 1}primary{else}default{/if}">自定义页面</a>
                            <a href="{php echo web_url('chosen/diy/pagelist',array('page_type'=>2))}" class="btn btn-{if $_GPC['page_type'] == 2}primary{else}default{/if}">平台首页</a>
                            <!--<a href="{php echo web_url('chosen/diy/pagelist',array('page_type'=>3))}" class="btn btn-{if $_GPC['page_type'] == 3}primary{else}default{/if}">抢购首页</a>-->
                            <!--<a href="{php echo web_url('chosen/diy/pagelist',array('page_type'=>4))}" class="btn btn-{if $_GPC['page_type'] == 4}primary{else}default{/if}">团购首页</a>-->
                            <!--<a href="{php echo web_url('chosen/diy/pagelist',array('page_type'=>5))}" class="btn btn-{if $_GPC['page_type'] == 5}primary{else}default{/if}">卡券首页</a>-->
                            <!--<a href="{php echo web_url('chosen/diy/pagelist',array('page_type'=>6))}" class="btn btn-{if $_GPC['page_type'] == 6}primary{else}default{/if}">拼团首页</a>-->
                            <!--<a href="{php echo web_url('chosen/diy/pagelist',array('page_type'=>7))}" class="btn btn-{if $_GPC['page_type'] == 7}primary{else}default{/if}">砍价首页</a>-->
                        {/if}
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-2 control-label">页面名称</div>
                    <div class="col-sm-9">
                        <input type="text" class="form-control" name="page_name" value="{$pageName}" placeholder="请输入页面名称">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-2 control-label"></div>
                    <div class="col-sm-6">
                        <div class="input-group">
                            <button class="btn btn-primary" type="submit" >搜索</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <!--页面列表-->
    <div class="app-table-list">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th class="text-center" >页面名称</th>
                    <th class="text-center" >页面类型</th>
                    <th class="text-center" >创建时间</th>
                    <th class="text-center" >最近编辑时间</th>
                    <th class="text-center" >操作</th>
                </tr>
                </thead>
                <tbody>
                {loop $list $v}
                    <tr class="text-center">
                        <td class="pageName" style="cursor: pointer">{$v['name']}</td>
                        <td>
                            {if $v['type'] == 1}
                                <span style="color: #ffffff;background: linear-gradient(14deg,#81dc69,#4dad36);padding: 5px 10px;border-radius: 15px;">自定义页面</span>
                            {elseif $v['type'] == 2}
                                <span style="color: #ffffff;background: linear-gradient(14deg,#f3b9b9,#e64d4d);padding: 5px 10px;border-radius: 15px;">平台首页</span>
                            {elseif $v['type'] == 3}
                                <span style="color: #ffffff;background: linear-gradient(14deg,#b1bfd8,#6a76cc);padding: 5px 10px;border-radius: 15px;">抢购首页</span>
                            {elseif $v['type'] == 4}
                                <span style="color: #ffffff;background: linear-gradient(14deg,#e6bce4,#c870e4);padding: 5px 10px;border-radius: 15px;">团购首页</span>
                            {elseif $v['type'] == 5}
                                <span style="color: #ffffff;background: linear-gradient(14deg,#e3e6bc,#e4cb70);padding: 5px 10px;border-radius: 15px;">卡券首页</span>
                            {elseif $v['type'] == 6}
                                <span style="color: #ffffff;background: linear-gradient(14deg,#d5e6bc,#70e494);padding: 5px 10px;border-radius: 15px;">拼团首页</span>
                            {elseif $v['type'] == 7}
                                <span style="color: #ffffff;background: linear-gradient(14deg,#dabce6,#70d9e4);padding: 5px 10px;border-radius: 15px;">砍价首页</span>
                            {/if}
                        </td>
                        <td>{php echo date("Y-m-d H:i:s",$v['createtime']);}</td>
                        <td>{php echo date("Y-m-d H:i:s",$v['lastedittime']);}</td>
                        <td style="position: relative;">
                            <a class="btn btn-info btn-sm js-clip" data-url="{php echo app_url('diypage/diyhome/home', array('aid' => $_W['aid'], 'id' => $v['id']))}" href="javascript:;">复制链接</a>
                            <a class="btn btn-warning btn-sm" data-toggle="ajaxModal" href="{php echo web_url('diy/diy/previewPage', array('id'=>$v['id'],'type'=>'list'))}">预览</a>
                            {if $v['aid'] == $_W['aid'] || (empty($_W['aid']) && !empty($v['is_public'])) }
                                <a class="btn btn-sm btn-primary" href="{php echo web_url('diy/diy/editPage',array('id'=>$v['id'],'type'=>$v['type'],'page_type'=>'page','page_class'=>$v['page_class'],'back_url'=>$backUrl))}" target="_blank">编辑</a>
                                <a class="btn btn-sm btn-danger" data-toggle="ajaxRemove" href="{php echo web_url('diy/diy/delPage',array('id'=>$v['id']))}" data-confirm="确定删除当前页面?">删除</a>
                                {if !empty($v['aid'])}
                                <a class="btn btn-sm btn-default pageSetPulbic" data-href="{php echo web_url('diypage/diyset/pageSetPublic',array('id'=>$v['id'],'type'=>1))}" is_public="{$v['is_public']}">{if $v['is_public'] == 1}设为私有页面{else}设为公共页面{/if}</a>
                                {/if}
                            {/if}
                        </td>
                    </tr>
                {/loop}
                </tbody>
            </table>
        </div>
        <div class="app-table-foot clearfix">
			<div class="pull-left">
			</div>
			<div class="pull-right">
				{$pager}
			</div>
		</div>
    </div>
    <!--弹出框内容-->
    <div id="select_pageClass">
        <div class="pageClass_title">选择类型<span class="pageClass_del">X</span></div>
        {if $pageClass == 1}
            <div class="pageClass_content">
                <div class="pageClass_block">
                    <span class="title">自定义页面</span>
                    <span class="createButton">
                    <a href="{php echo web_url('diy/diy/editPage',array('type'=>1,'page_type'=>'page','page_class'=>$pageClass,'back_url'=>$backUrl));}">
                        <span>立即创建</span>
                    </a>
                </span>
                </div>
                <div class="pageClass_block">
                    <span class="title">平台首页</span>
                    <span class="createButton">
                     <a href="{php echo web_url('diy/diy/editPage',array('type'=>2,'page_type'=>'page','page_class'=>$pageClass,'back_url'=>$backUrl));}">
                        <span>立即创建</span>
                    </a>
                </span>
                </div>
                <div class="pageClass_block">
                    <span class="title">抢购首页</span>
                    <span class="createButton">
                     <a href="{php echo web_url('diy/diy/editPage',array('type'=>3,'page_type'=>'page','page_class'=>$pageClass,'back_url'=>$backUrl));}">
                        <span>立即创建</span>
                    </a>
                </span>
                </div>
                <div class="pageClass_block">
                    <span class="title">团购首页</span>
                    <span class="createButton">
                     <a href="{php echo web_url('diy/diy/editPage',array('type'=>4,'page_type'=>'page','page_class'=>$pageClass,'back_url'=>$backUrl));}">
                        <span>立即创建</span>
                    </a>
                </span>
                </div>
                <div class="pageClass_block">
                    <span class="title">卡券首页</span>
                    <span class="createButton">
                     <a href="{php echo web_url('diy/diy/editPage',array('type'=>5,'page_type'=>'page','page_class'=>$pageClass,'back_url'=>$backUrl));}">
                        <span>立即创建</span>
                    </a>
                </span>
                </div>
                <div class="pageClass_block">
                    <span class="title">拼团首页</span>
                    <span class="createButton">
                     <a href="{php echo web_url('diy/diy/editPage',array('type'=>6,'page_type'=>'page','page_class'=>$pageClass,'back_url'=>$backUrl));}">
                        <span>立即创建</span>
                    </a>
                </span>
                </div>
                <div class="pageClass_block">
                    <span class="title">砍价首页</span>
                    <span class="createButton">
                     <a href="{php echo web_url('diy/diy/editPage',array('type'=>7,'page_type'=>'page','page_class'=>$pageClass,'back_url'=>$backUrl));}">
                        <span>立即创建</span>
                    </a>
                </span>
                </div>
            </div>
        {else}
            <div class="pageClass_content">
                <div class="pageClass_block">
                    <span class="title">自定义页面</span>
                    <span class="createButton">
                    <a href="{php echo web_url('diy/diy/editPage',array('type'=>1,'page_type'=>'page','page_class'=>$pageClass,'back_url'=>$backUrl));}">
                        <span>立即创建</span>
                    </a>
                </span>
                </div>
                <div class="pageClass_block">
                    <span class="title">平台首页</span>
                    <span class="createButton">
                     <a href="{php echo web_url('diy/diy/editPage',array('type'=>2,'page_type'=>'page','page_class'=>$pageClass,'back_url'=>$backUrl));}">
                        <span>立即创建</span>
                    </a>
                </span>
                </div>
            </div>
        {/if}
    </div>
</div>
<script>
    //新建内容
    $("#create_page").on('click',function () {
        $("#select_pageClass").modal();
    });
    //关闭页面
    $("#select_pageClass").on('click','.pageClass_del',function () {
        $("#select_pageClass").modal('hide');
    });
    //将页面设置为公共页面
    $(".pageSetPulbic").on('click',function () {
        var the = $(this);
        var url = the.data("href");
        var is_public = the.attr("is_public");
        var tips = '确定要将该页面设为公共页面吗？设置后每个代理商都可以使用该页面';
        if(is_public == 1){
            tips = '确定要将该页面设为私有页面吗？设置后其他代理商将不可使用该页面';
        }
        tip.confirm(tips,function () {
            $.post(url,function (res) {
                if(res.errno == 1){
                    the.html("设为公共页面");
                    the.attr("is_public",0);
                    {if empty($_W['aid'])}
                    location.reload();
                    {/if}
                }else{
                    the.html("设为私有页面");
                    the.attr("is_public",1);
                }
            },'json');
        });
    });
</script>
{php include wl_template('common/footer');}
